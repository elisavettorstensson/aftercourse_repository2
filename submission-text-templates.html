<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Submission request text templates</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="submission-text-templates_files/libs/clipboard/clipboard.min.js"></script>
<script src="submission-text-templates_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="submission-text-templates_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="submission-text-templates_files/libs/quarto-html/popper.min.js"></script>
<script src="submission-text-templates_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="submission-text-templates_files/libs/quarto-html/anchor.min.js"></script>
<link href="submission-text-templates_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="submission-text-templates_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="submission-text-templates_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="submission-text-templates_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="submission-text-templates_files/libs/bootstrap/bootstrap-6e70023e03052827610af39d5bd37d6e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Submission request text templates</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Communication templates in the <a href="https://textile-lang.com">textile format</a> for use with Redmine.</p>
<section id="confirmation-of-submission-request" class="level2">
<h2 class="anchored" data-anchor-id="confirmation-of-submission-request">Confirmation of submission request</h2>
<blockquote class="blockquote">
<p>Dear [Name of Submitter],</p>
<p>Thank you for your submission request to FEGA Sweden. Your request has now been placed in our queue system and has been assigned with the issue number [Redmine issue number]. When we start processing your request, we will evaluate whether it falls within the scope of FEGA Sweden or not (learn more about our “assessment criteria”:<a href="https://fega.nbis.se/submission/is-fega-sweden-the-right-archive.html" class="uri">https://fega.nbis.se/submission/is-fega-sweden-the-right-archive.html</a>). As part of the evaluation we will contact the data controller to confirm that the data can be deposited in FEGA Sweden.</p>
<p>Should you have any questions or concerns, please do not hesitate to contact us.</p>
<p>Best regards,</p>
<p>FEGA Sweden Helpdesk Team</p>
</blockquote>
</section>
<section id="decision-to-not-proceed-with-out-of-scope-submission" class="level2">
<h2 class="anchored" data-anchor-id="decision-to-not-proceed-with-out-of-scope-submission">Decision to not proceed with out of scope submission</h2>
<blockquote class="blockquote">
<p>Dear [Name of Submitter],</p>
<p>Your submission request with the issue number [Redmine issue number] has now been evaluated. It has been concluded that your request falls outside the scope of FEGA Sweden since [include a short motivation]. Consequently, we regret to inform you that we will not be able to proceed with it. You are welcome to contact us if you have any questions regarding the decision.</p>
<p>Please feel free to reach out to us at FEGA Sweden again if you have any other data that you wish to submit. We are here to assist you.</p>
<p>Best regards,</p>
<p>[Name of helpdesk officer], FEGA Sweden</p>
</blockquote>
</section>
<section id="setting-up-an-initial-zoom-meeting" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-an-initial-zoom-meeting">Setting up an initial Zoom-meeting</h2>
<blockquote class="blockquote">
<p>Dear [Name of Submitter],</p>
<p>My name is [Name of helpdesk officer] and I have been assigned to review your submission request. In order to complete the review, I would like to ask you a few questions regarding your request. Would you be available for a meeting over Zoom sometime in the [next few days/coming week]? The meeting shouldn’t take more than 30 minutes.</p>
<p>Best regards,</p>
<p>[Name of helpdesk officer], FEGA Sweden</p>
</blockquote>
</section>
<section id="asking-for-additional-information" class="level2">
<h2 class="anchored" data-anchor-id="asking-for-additional-information">Asking for additional information</h2>
<blockquote class="blockquote">
<p>Dear [Name of Submitter],</p>
<p>My name is [Name of helpdesk officer], and I have been assigned to review your submission request at FEGA Sweden [Redmine issue number]. To complete the review, which I will do with my colleague [Name of helpdesk officer], we require some additional information. Please fill in the attached PDF form and return it by replying to this email. Kindly ensure that you also provide copies of your ethical permits. In more detail, please attach both the application for the ethical approval (original application and any renewal applications) and the decision(s) from the Swedish Ethical Review Authority.</p>
<p>The information you provide will be forwarded to the Data Access Unit (DAU) or the Data Research Office of the organization you have listed as the data controller to verify your submission request.</p>
<p>If you have any questions or concerns, please don’t hesitate to contact us by replying to this email.</p>
<p>Thank you for your cooperation and understanding.</p>
<p>Best regards,</p>
<p>[Name of helpdesk officer], FEGA Sweden</p>
</blockquote>
</section>
<section id="asking-dau-to-approve-submission-request" class="level2">
<h2 class="anchored" data-anchor-id="asking-dau-to-approve-submission-request">Asking DAU to approve submission request</h2>
<blockquote class="blockquote">
<p><strong>Ämne:</strong> FEGA Sweden: Godkännande av deponering för deponeringsärende [ärendenr]</p>
<p>Hej [Namn på kontaktperson],</p>
<p>Vi har mottagit en begäran från en forskare om att deponera data i FEGA Sweden, vårt ärendenummer #[ärendenr].</p>
<p>Utifrån informationen i det bifogade formuläret och den etiska dokumentationen bedömer vi att [namn på organisation] sannolikt är personuppgiftsansvarig.</p>
<p>För att kunna gå vidare ber vi er vänligen bekräfta att datan tillhör er organisation och att ni godkänner deponeringen.</p>
<p>När vi mottagit er bekräftelse och godkännande kommer vi att fortsätta med deponeringen. Observera att ni kommer att informeras innan publik metadata tillgängliggörs.</p>
<p>Tack för ert samarbete och tveka inte att kontakta oss om ni har några frågor.</p>
<p>Med vänliga hälsningar,</p>
<p>[För- och efternamn], FEGA Sweden</p>
</blockquote>
</section>
<section id="decision-to-not-proceed-with-submission-after-rejection-by-dau" class="level2">
<h2 class="anchored" data-anchor-id="decision-to-not-proceed-with-submission-after-rejection-by-dau">Decision to not proceed with submission after rejection by DAU</h2>
<blockquote class="blockquote">
<p>Dear [Name of Submitter],</p>
<p>I regret to inform you that your submission request with the issue number [Redmine issue number] has been rejected by [Name of the DAU] due to the reason [short motivation]. Consequently, we will not be able to proceed with your request.</p>
<p>Should you have any questions or require further clarification regarding this decision, please do not hesitate to contact us. We are here to assist you in any way we can.</p>
<p>Thank you for your understanding and cooperation.</p>
<p>Best regards,</p>
<p>[Name of helpdesk officer], FEGA Sweden</p>
</blockquote>
</section>
<section id="decision-to-proceed-with-your-submission-request-and-instructions-for-ega-registration" class="level2">
<h2 class="anchored" data-anchor-id="decision-to-proceed-with-your-submission-request-and-instructions-for-ega-registration">Decision to proceed with your submission request and instructions for EGA registration</h2>
<blockquote class="blockquote">
<p>Dear [Name of Submitter],</p>
<p>We are pleased to inform you that your submission request with the issue number [Redmine issue number] has been approved by [Name of the DAU]. We will now proceed with your request. Here is what you need to do next.</p>
<p><strong>Check EGA Account</strong></p>
<ul>
<li>If you already have an EGA account, let us know the email address you used when creating your account, and we will add you to the “FEGA Sweden Submitter Portal”: <a href="https://submission.sweden.ega-archive.org/" class="uri">https://submission.sweden.ega-archive.org/</a>.</li>
<li>If not, please:</li>
</ul>
<ol type="a">
<li>Register at EGA: Fill out the “registration form” <a href="https://ega-archive.org/register/" class="uri">https://ega-archive.org/register/</a> at EGA and wait for approval.</li>
<li>Notify us: Once approved, provide us with the email address you used when creating your account, and we will add you to the Submitter Portal.</li>
</ol>
<p>If you have any questions or need further assistance, feel free to reach out to us. We are here to help.</p>
<p>Best regards,</p>
<p>[Name of helpdesk officer], FEGA Sweden</p>
</blockquote>
</section>
<section id="instructions-for-metadata-registration-and-data-upload-to-fega-sweden" class="level2">
<h2 class="anchored" data-anchor-id="instructions-for-metadata-registration-and-data-upload-to-fega-sweden">Instructions for metadata registration and data upload to FEGA Sweden</h2>
<blockquote class="blockquote">
<p>Dear [Name of submitter],</p>
<p>Welcome to the FEGA Sweden Submitter Portal! You have now been added as a submitter and can begin the process of creating your submission by registering your metadata and uploading your data. Below, we’ve provided simplified instructions to help you get started.</p>
<p><strong>Steps to Follow:</strong></p>
<ol type="1">
<li><p><strong>Log in to the Submitter Portal</strong><br>
Log in to the FEGA Sweden Submitter Portal [<a href="https://submission.sweden.ega-archive.org/">https://submission.sweden.ega-archive.org/</a>] to access your submission workspace. For optimal performance, it’s recommended to use your web browser in <strong>Incognito mode</strong> when accessing the Submitter Portal.</p></li>
<li><p><strong>Take the Tour</strong><br>
Before creating your submission, click the “Take the Tour” button (located next to your name in the portal). This will guide you through the steps for registering metadata.</p></li>
<li><p><strong>Create a Submission</strong><br>
Once logged in, click the green “Create a Submission” button to start your submission.</p></li>
<li><p><strong>Encrypt and Upload Your Data</strong><br>
In order to enter some of your metadata successfully (such as Runs, Analysis and Datasets), you must upload your data files first by following the steps outlined in the Data Upload Guide [ <a href="https://fega.nbis.se/submission/uploading-data.html">https://fega.nbis.se/submission/uploading-data.html</a> ]</p></li>
</ol>
<p><strong>Important Notices:</strong></p>
<ul>
<li><p>Some metadata fields in the Submitter Portal can only be completed after your files are uploaded.</p></li>
<li><p>Please note that some pages on the FEGA Sweden website contain outdated content. If you encounter any issues with these parts, please contact us for further clarification.</p></li>
<li><p>Do not press the <strong>“Finalise” button</strong> until you have contacted us for a review of your submission.</p></li>
<li><p>For further guidance, you can watch the following <strong>YouTube video,</strong> which demonstrates the EGA Submitter Portal. This portal is similar to the FEGA Sweden Submitter Portal that you will use for your submission. Please note that since the video is two years old, there may be some updates or differences.</p></li>
</ul>
<p><strong>Here is the link:</strong> <a href="https://www.youtube.com/watch?v=o81GDFwXiGE&amp;t=98s">https://www.youtube.com/watch?v=o81GDFwXiGE&amp;t=98s</a></p>
<p>We understand that this might feel new and challenging. Please don’t hesitate to reach out if you need assistance—we’re here to guide you every step of the way.</p>
<p>Best regards,</p>
<p>[Name of helpdesk officer], FEGA Sweden</p>
</blockquote>
</section>
<section id="supplementary-metadata-instructions-for-submitters" class="level2">
<h2 class="anchored" data-anchor-id="supplementary-metadata-instructions-for-submitters">Supplementary Metadata Instructions for Submitters</h2>
<blockquote class="blockquote">
<p>Dear [Name of the submitter],</p>
<p>We’ve noticed that you have started working on your submission in our submitter portal. I’d like to share some tips for structuring your metadata effectively. Properly organizing your metadata from the start can significantly reduce the need for extensive reviews and time-consuming revisions later on.</p>
<p><strong>Metadata Guidelines for the Submitter Portal:</strong></p>
<p><strong>Studies</strong></p>
<ul>
<li><strong>Title</strong>: Write a concise title (3–20 words) that introduces your project.<br>
</li>
<li><strong>Description</strong>: Write a short project definition (3–5 sentences) covering the project’s background, goals, and key details.</li>
</ul>
<p>Examples of well-written study titles and descriptions:</p>
<p>See this example from SweGen project:</p>
<ul>
<li><a href="https://ega-archive.org/studies/EGAS50000000906">https://ega-archive.org/studies/EGAS50000000906</a></li>
</ul>
<p>See this example from Swedish Childhood Tumour Biobank:</p>
<ul>
<li><a href="https://ega-archive.org/studies/EGAS50000000209">https://ega-archive.org/studies/EGAS50000000209</a></li>
</ul>
<p><strong>Samples</strong></p>
<ul>
<li>Ensure no <a href="https://gdpr.eu/eu-gdpr-personal-data/">personal data</a> (e.g., names, national ID numbers, addresses) is included.<br>
</li>
<li>In case you have a large number of Samples to register, use the batch upload feature.</li>
</ul>
<p><strong>Experiments</strong></p>
<ul>
<li><strong>Design Name</strong>: Summarise the library preparation, including the scientific goal, experimental conditions, and key methodology.</li>
</ul>
<p><strong>Tip</strong>: Your sequencing facility report often includes relevant descriptions—feel free to adapt that text when entering the <em>Design Name</em>.</p>
<p><strong>Runs</strong></p>
<ul>
<li>In case you have a large number of Runs to register, use the batch upload feature.</li>
</ul>
<p><strong>Analyses</strong></p>
<ul>
<li><strong>Title</strong>: Write a short and descriptive title of the analysis.</li>
</ul>
<p>Here is an example from the SweGen project: <em>SweGen genetic variation</em></p>
<ul>
<li><strong>Description</strong>: Write a detailed explanation for the analysis. This should describe the experiment, methods, and goals.</li>
</ul>
<p>Here is an example from the SweGen project:</p>
<p><em>Single nucleotide variants in VCF format and associated index files. FASTQ files generated by Illumina HiSeq X Ten WGS were analyzed using the nf-core pipeline Sarek, which includes pre-processing, alignment to the human GRCh38 reference genome, and germline variant calling</em>.</p>
<p><strong>Notice:</strong></p>
<ul>
<li>Consider including relevant metadata in this part of the submission. If you have a BAM/BAI or CRAM/CRAI pair, VCF and phenotype linkage to samples, it’s best to include them under the <strong>“Analyses”</strong> tab.<br>
</li>
<li>Ideally, the BAM or CRAM files should be included under the <strong>“Analyses”</strong> as this allows you to provide detailed metadata, such as the reference genome and the chromosomes involved, which adds important context for future researchers accessing your data.</li>
</ul>
<p>If these files are not added here, crucial metadata may be omitted, potentially limiting the reusability and interpretability of the data in future research.</p>
<p><strong>Datasets</strong></p>
<ul>
<li><p><strong>Title</strong>: Write a concise title (3–20 words) describing the dataset content.<br>
</p></li>
<li><p><strong>Description</strong>: Provide a 3–4 sentence summary including sample details, file types, and experimental methods.</p></li>
<li><p><strong>Policy</strong>: Manually enter the policy accession number you have received from us (EGAPXXXXXXXXXXX), as copy-pasting might not work.</p></li>
</ul>
<p>Examples of well-written dataset titles and descriptions:</p>
<p>See these examples from SweGen project:</p>
<ul>
<li><a href="https://ega-archive.org/datasets/EGAD50000001323">https://ega-archive.org/datasets/EGAD50000001323</a><br>
</li>
<li><a href="https://ega-archive.org/datasets/EGAD50000001324">https://ega-archive.org/datasets/EGAD50000001324</a></li>
</ul>
<p>See these examples from Swedish Childhood Tumour Biobank:</p>
<ul>
<li><a href="https://ega-archive.org/datasets/EGAD50000000298">https://ega-archive.org/datasets/EGAD50000000298</a><br>
</li>
<li><a href="https://ega-archive.org/datasets/EGAD50000000300">https://ega-archive.org/datasets/EGAD50000000300</a></li>
</ul>
<p>If you have any questions while working on these sections, please don’t hesitate to refer to this and previous emails for additional guidance or reach out directly. We’re here to support you every step of the way!</p>
<p>Best regards,</p>
<p>[Name of helpdesk officer], FEGA Sweden</p>
</blockquote>
</section>
<section id="information-to-dau-about-upcoming-release" class="level2">
<h2 class="anchored" data-anchor-id="information-to-dau-about-upcoming-release">Information to DAU about upcoming release</h2>
<blockquote class="blockquote">
<p><strong>Ämne:</strong> FEGA Sweden: Kommande publicering av metadata – deponering: [ärendenr]</p>
<p>Hej [Namn på kontaktperson],</p>
<p>Vi vill härmed informera er om att metadata kopplad till deponeringsärende [ärendenr] kommer att publiceras på ega-archive.org den [datum för publiceringen]. Ni har tidigare godkänt denna deponering och detta mejl är enbart för kännedom.</p>
<p>Observera att endast <strong>metadata</strong> blir synlig för att forskare ska kunna hitta data. Själva data blir tillgängliga först efter en godkänd ansökan om tillgång, enligt den överenskomna processen för utlämning av data i FEGA Sweden.</p>
<p>Nedan finner ni länkar till den/de studier och dataset som kommer att publiceras:</p>
<ul>
<li><strong>Studie:</strong> [namn och infoga länk(ar)]</li>
<li><strong>Dataset:</strong> [namn och infoga länk(ar)]</li>
</ul>
<p>Tveka inte att kontakta oss om ni har några frågor eller funderingar.</p>
<p>Med vänliga hälsningar,</p>
<p>[För- och efternamn], FEGA Sweden</p>
</blockquote>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>